# 如何建立一个玩赚(P2E)游戏智能合同

> 原文：<https://moralis.io/how-to-build-a-play-to-earn-p2e-game-smart-contract/>

**即玩即赚(P2E)游戏现在是** [**Web3**](https://moralis.io/the-ultimate-guide-to-web3-what-is-web3/) **生态系统中的主要用例。像 Axie Infinity，Splinterlands，Sandbox，Gods Unchained 等 P2E 游戏的流行已经证明了 P2E 的潜力。再者，** [**Web3 游戏化**](https://moralis.io/web3-gamification-creating-a-coinmarketcap-diamonds-dapp/) **无疑是******web 3 增长的下一个前沿。它结合了娱乐、用户收入和更大的游戏收入潜力。因此，为了顺应这一趋势，Web3 开发者现在必须学会如何开发一款游戏。如果你认为开发一个玩到赚到的游戏似乎很难，这个教程会让你放松。****

**任何熟悉 [JavaScript](https://moralis.io/javascript-explained-what-is-javascript/) 、 [Solidity](https://moralis.io/solidity-explained-what-is-solidity/) 、以太坊和[智能合约](https://moralis.io/smart-contracts-explained-what-are-smart-contracts/)的区块链开发者，应该不会觉得开发一款“玩赚”游戏有什么障碍。此外，最终的 Web3 开发平台 Moralis 提供了资源和工具，可以让任何 P2E 以闪电般的速度进行构建。因此，有了 Moralis，你可以立即开始为 [Web3 元宇宙](https://moralis.io/web3-metaverse-how-do-web3-and-the-metaverse-fit-together/)构建 dapps。**

**在这个简单易懂的教程中，你将学习如何建立一个玩赚游戏智能合同。此外，你将获得正确的工具和捷径，以抓住先发优势。此外，Moralis 将为您处理后端的所有繁重工作。因此，您可以专注于前端和用户体验，以开发一个更具吸引力和吸引力的 P2E 游戏，成功的机会更高。**

**随着最受欢迎的 P2E 游戏估值达到数十亿美元，Web3 游戏的事情才刚刚开始。作为一个区块链开发商，全球市场对你来说是敞开的，你可以创造下一个卖座的游戏。**

### **如何开发 P2E 游戏的视频教程**

**Moralis 的 YouTube 频道包含许多关于不同区块链游戏项目的教程。下面，你会发现本文中给出的教程的视频版本:**

**https://www.youtube.com/watch?v=1_qCiL0qajs

***注:*** *这里的教程不会深入到如何构建一个玩赚游戏的实际编码步骤。因此，我们强烈建议您观看视频教程，其中 Moralis 的一位专家就如何开发我们的 P2E 游戏提供了专家指导的步骤。* *T8】*

## 用 Moralis 毫不费力地开发一个玩到赚的游戏

随着围绕 Web3 和 P2E 游戏的讨论点燃了全球游戏玩家的好奇心，任何开发者都会很兴奋地学习如何构建一个“玩到赚”的游戏，并进入这个具有巨大收入潜力的市场。幸运的是，由于有了像 Moralis 这样的 Web3 游戏开发平台，这个过程现在变得更快、更无缝，Moralis 的[元宇宙 SDK](https://moralis.io/metaverse/) 为有抱负的区块链游戏开发者打开了一个充满机会的世界。

更重要的是，Moralis 的元宇宙 SDK 是快速轻松地启动元宇宙游戏和 dapps 的最佳方式。如前所述，它处理你所有的后端支持。无论是通过 [Moralis Speedy Nodes](https://moralis.io/speedy-nodes/?utm_source=blog&utm_medium=post&utm_campaign=How%2520to%2520Build%2520Cross-Chain%2520dApps) 提供的区块链节点支持，通过 [MetaMask](https://moralis.io/metamask-explained-what-is-metamask/) 和其他 [Web3 钱包](https://moralis.io/what-is-a-web3-wallet-web3-wallets-explained/?utm_source=blog&utm_medium=post&utm_campaign=How%2520to%2520Add%2520a%2520Web3%2520Connect%2520Wallet%2520Button%2520to%2520Your%2520Website)提供的 [Web3 身份验证](https://moralis.io/web3-authentication-the-full-guide/?utm_source=blog&utm_medium=post&utm_campaign=How%2520to%2520Add%2520a%2520Web3%2520Connect%2520Wallet%2520Button%2520to%2520Your%2520Website)，为您的[跨链 dapp](https://moralis.io/how-to-build-cross-chain-dapps/)提供的最佳兼容性，还是满足 Web3 集成所有需求的 API，Moralis 都能满足您的需求。此外，当使用 Moralis 时，你可以期待一个平稳的 P2E、 [GameFi](https://moralis.io/gamefi-tutorial-how-to-create-a-gamefi-game/) 或 [NFT 游戏开发](https://moralis.io/nft-game-development-how-to-build-an-nft-game-app-in-minutes/)过程。此外，Moralis 还可以立即兼容 Unity、Xbox 和 iOS 等世界顶级游戏和游戏开发平台。因此，这是一个完整的 360 度的包，当你想要建立一个玩赚游戏。

如果你刚刚开始你的 [Unity Web3 编程](https://moralis.io/unity-web3-beginners-guide-to-unity-web3-programming/)之旅，Moralis 是你制作市场上最好的 Web3 游戏的最佳平台。

## 什么是玩赚(P2E)？

通过游戏和分散金融(DeFi)的融合，出现了“玩赚”(Play-to-earn)或 P2E。此外，它通过将体验与 [ERC-20](https://moralis.io/erc20-exploring-the-erc-20-token-standard/) 代币、加密货币和不可替代代币(NFT)直接联系起来，为游戏增添了新的动力。只需将您的 Web3 钱包(如 MetaMask)连接到 Web3 游戏，您就可以获得一个唯一的游戏身份、一个发送和接收令牌的钱包以及一个存储唯一对象(称为 NFTs)的地址。

![](img/a217c84b852906baff1aef3e99de5c86.png)

NFTs 的成功也成为 P2E 游戏受欢迎的一个因素。但是，[什么是 NFT](https://moralis.io/non-fungible-tokens-explained-what-are-nfts/)？NFT 是数字上唯一的对象。通过像 [ERC-721](https://moralis.io/erc721-contract-exploring-erc721-smart-contracts/) 和 [ERC-1155](https://moralis.io/erc1155-exploring-the-erc-1155-token-standard/) 这样的令牌标准，现在可以为数字艺术品和游戏对象创建独特的出处。此外，你可以创造一个[游戏中的 NFT](https://moralis.io/how-to-claim-an-in-game-nft-full-guide/) ，以奖励、武器、礼物、复活节彩蛋、衣服和其他稀有物品的形式出现。更重要的是，你甚至可以把你的头像变成 NFT！Web3 元宇宙已经允许在游戏环境中认领、交换、存储、购买或出售这样的对象。这种 NFT 甚至可以被带到游戏环境之外，因为存储它们的钱包是一个更大的 Web3 区块链网络的一部分。因此，NFT 既是游戏财产，也是超越游戏的资产。

更重要的是，你可以转让和交易游戏中可替换的 ERC 20 资产。此外，这些代币可以在分散的交易所独立交易。因此，支付给玩家的代币或货币可以兑换成其他形式的数字货币。也就是说，P2E 将游戏的货币层面扩展到了游戏本身之外。

## 在创纪录的时间内建立一个从玩到赚的游戏智能合同

一个 P2E 游戏需要吸引人和有趣。虽然用户希望获得收入，但糟糕的游戏设计或游戏玩法是无法弥补的。但如果你精通用 Unity 创作游戏，那么进阶到 [Unity Web3 编程](https://moralis.io/unity-web3-beginners-guide-to-unity-web3-programming/)并把好的设计和 Web3 的特性结合起来，并不需要太多。

此外，当你建立一个游戏赚取，请记住，游戏机制应该公平和平衡。请记住，你正在创造一个具有潜在价值的代币融入游戏的经济。

![](img/eb4e4e2c6abb943b40eb8157a80dcfd9.png)

在附带的视频教程(之前提供)中，我们从一个名为“银行恐慌”的演示相位器游戏开始。这款游戏已经包含了 Web3 钱包登录功能。此外，它根据用户的 NFT 余额授予访问权限。从这个基础出发，我们将学习如何创建一个将加密令牌集成到游戏中的游戏赚取机制。

因此，请务必获取 [Codebase GitHub Repo](https://github.com/ashbeech/moralis-phaser-demo) ，这样您就可以与我们的教程保持一致。

### 建立一个玩赢游戏的智能合约

我们教程的游戏设计的第一部分要求玩家在游戏中放置皮肤。换句话说，这是付费游戏，所以玩家必须获得原生游戏代币。这个特性对于平衡游戏经济至关重要。接下来，游戏将要求玩家下注少量的本地代币。

与付费游戏相比，免费游戏的优势在于进入门槛低，一开始就能吸引更多用户。然而，免费游戏的经济设计需要更高的复杂程度。因此，我们将坚持付费游戏模式，因为我们处于初学者模式。然而，我们将在付费游戏模式中保持尽可能低的准入门槛。

#### 智能合同要求

当您构建一个“玩即赚”游戏时，所需的智能合约的基本类型包括:

*   玩家输了
*   玩家获胜
*   玩家钱包和游戏管理员之间的代币交换
*   游戏的金库钱包

为了说明智能合约处理的这种情况，下面是一些图表:

##### 场景 1:玩家获胜

![](img/76221a4f72f90555867752419625ddf2.png)

在这种情况下，玩家赢得或击败游戏。因此，当玩家赢得游戏时，他们会收到他们的游戏奖金以及他们下注的代币。

##### 场景 2:玩家输了

![](img/c30caa3a1a3f3bcd9d9876df7c7ced3f.png)

如果玩家输掉游戏，他们将失去他们的筹码。因此，代币被送回游戏的金库。

### 激励设计

随着玩家的进步和赢得更多代币，游戏经济需要保持平衡。因此，智能合约( [Web3 合约](https://moralis.io/what-are-web3-contracts-exploring-smart-contracts/))为游戏的经济设定了规则，并且是执行这种设计的一个组成部分。在这个特别的演示中，玩家的进度和代币积累被更高的难度曲线所平衡。因此，当你升级到更高的等级时，你失去代币的机会增加了。

为了保持经济平衡，智能合同应该模仿托管流程。此外，本教程将教你如何使用 Moralis API 从游戏的前端接口。

这个游戏需要两个相对简单的智能合约。第一个契约创建游戏的令牌，在本教程中称为“黄金”。该令牌是使用 ERC-20 令牌标准的可替换令牌。此外，这是一个简单的铸造合同，你可以通过访问:[https://github.com/OpenZeppelin/openz…](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/fcf35e5722847f5eadaaee052968a8a54d03622a/contracts/token/ERC20/ERC20.sol)获得。

第二个合同创建了“黄金”代币从玩家到金库的移动和返回。此外，您必须以尽可能不信任和不允许的方式来做这件事。

#### 测试网龙头

在 2:28 的“建立一个游戏赚取智能合同”视频教程(如上所示)，你将学习如何使用[孟买测试网龙头](https://moralis.io/mumbai-testnet-faucet-how-to-get-free-testnet-matic-tokens/?utm_source=blog&utm_medium=post&utm_campaign=How%2520to%2520Build%2520a%2520Play-to-Earn%2520%28P2E%29%2520Game)，这样你就可以得到你的“玩”MATIC 测试网令牌。testnet 令牌是在 Mumbai，Polygon 的 testnet 上部署智能合约所必需的。

*为什么要用多边形？一些人更喜欢使用 Polygon 的一个主要原因是因为它是一个* [*以太坊*](https://moralis.io/full-guide-what-is-ethereum/?utm_source=blog&utm_medium=post&utm_campaign=Mumbai%2520Testnet%2520Faucet%2520%25E2%2580%2593%2520How%2520to%2520Get%2520Free%2520Testnet%2520MATIC%2520Tokens) *第二层解决方案，优先考虑互操作性、高可伸缩性和低交易费用。*

#### 代币流和铸造玩赢游戏智能合同

在 3:11，你会在游戏中找到智能合约的例子。此外，您会发现“ [P2EGame.sol](https://github.com/ashbeech/moralis-phaser-demo/blob/main/src/contracts/P2EGame.sol) ”智能合约处理游戏中的令牌流。此外，“ [GameToken.sol](https://github.com/ashbeech/moralis-phaser-demo/blob/main/src/contracts/GameToken.sol) ”契约处理代币铸造。它借用了“开放齐柏林 ERC-20”合同(如前所述)。之后，您将继续进行合同部署的重新混合。

下面的示例合同(见视频中的 3:19)铸造了 100 个游戏令牌，并将它们发送到游戏的 dev wallet:

![](img/6e7fd4e73a6cfff9921c37803141ff93.png)

在这种情况下，它将作为行政和游戏库储备。请注意，您还将继承“Ownable ”,它允许放弃契约所有权的可能性，因此没有人可以拥有令牌契约。而且，第二份合同你也会这么做。

P2E 游戏合同(如前所述)充当玩家和游戏开发商金库之间的“黄金”代币的托管。在游戏开始时，玩家投入一枚“黄金”代币。获胜意味着玩家在托管中获得他们的赌注代币，加上他们在游戏中正式赢得的代币。后者是从游戏的国库储备中转出的。

另一方面，如果玩家输了，他们的代币将回到游戏的金库。对这一切的解释从本文前面陈述的视频的 3:56 开始。

## 建立一个游戏赚取智能合同:通过混合部署

首先，在你的网络浏览器上打开 Remix，建立一个游戏赚取智能合同。然后，点击“新建文件”，然后命名文件。在这种情况下，文件名将是“GameToken.sol”。从 [GitHub repo](https://github.com/ashbeech/moralis-phaser-demo/blob/main/src/contracts/GameToken.sol) 中粘贴正确的代码。转到编译，然后在 Polygon testnet (Mumbai)上部署契约。确保在您的环境中使用“注入的 Web3 ”,如下所示:

![](img/a62d0915e7f2b367bbe4a12e0855f168.png)

这个演示程序使用 MetaMask 连接到 Mumbai testnet，并使用一些 testnet MATIC 令牌来支付汽油费。契约的构造函数允许您为游戏令牌指定名称和股票代码。完成后，点击部署(如上所示)。

![](img/e18f39fd6947d218caeb48d21ee6902c.png)

到 5:32，您将被定向到 MetaMask 以导入新的自定义“Gold”令牌。复制粘贴合同地址，然后单击“添加自定义令牌”按钮。之后，您会发现您已经成功地部署了令牌。

接下来，您将使用游戏经济中创建的“黄金”代币。从回购中抓取代码(之前贴的“P2EGame.sol”链接)。接下来，从已部署的 ERC-20 合同中复制合同地址。将其粘贴到 P2E 契约中，然后编译并部署该契约到 testnet 中。

#### 智能合同的工作原理

部署了两个智能合约后，视频教程将演示游戏如何使用这些合约。为了进一步展示这些合同如何使您能够构建一个先玩后赚的游戏，请继续从 6:47 开始的演练。

使用 Remix 界面上的功能，你将模拟一个已经拥有“黄金”代币的玩家。然后使用合同将代币从当前国库持有者转移到演示玩家的钱包中。在这种情况下，它会将十个令牌转移到演示玩家的钱包中。

![](img/64dc603d948ec5fb7ce6c1d49d31e328.png)

本演练演示玩家如何通过元掩码进行身份验证。此外，游戏将要求玩家批准将他们的代币津贴放入托管合同中。然后，它会将批准的金额存入 P2E 合同，直到游戏结束。接下来，玩家开始游戏。如果玩家赢了，Moralis API 调用函数释放赌注代币和任何奖金。换句话说，它奖励了玩家。另一方面，输了就让 Moralis API 调用一个函数，将代币转移回游戏的金库。此外，该契约跟踪每个游戏的余额，并且仅在满足某些条件时以编程方式向获胜方释放资金。

### 合同所有权

当你开发一个“玩赚”游戏时，你不希望任何人拥有其中一个合同，并有能力以任何方式进行恶意行为。为了实现这一点，你设置两个合同的所有权，以便它们将被放弃。因此，您将它们设置为零(0)地址，唯一可以对这些函数进行操作的实体是管理员钱包，它根据游戏的逻辑以编程方式进行操作。

此外，游戏的金库不是一个附有一套私钥的钱包，而是一份所有权已经被放弃的合同。也可能是某个钱包的钥匙已经“丢失”或不为任何用户所知。

为了简单起见，这个演示对国库和管理员钱包使用相同的地址，将硬币移入和移出托管。但是，理想情况下，这两个地址应该是分开的。

### 建立一个玩赚游戏:通过 Moralis 整合

一旦你掌握了如何构建一个玩赚游戏及其智能合约的这些步骤，请务必检查下一步，即通过 Moralis 将智能合约集成到游戏中:

https://www.youtube.com/watch?v=h31YcNgAIUw

## 如何建立一份先玩后赚的游戏智能合同——总结

为了学习如何建立一个游戏赚取智能合同，你需要了解游戏的经济因素。一旦你有了一个具体的经济设计，你必须继续写智能合同，实现游戏中的规则。

有了 Moralis(又名】Firebase for crypto)在 Web3 元宇宙游戏设计中的领先地位，创建你的第一个 P2E 游戏将比你想象的更容易、更快。更重要的是，Moralis 是互操作性的顶级平台，所以你可以将你的游戏连接到任何想要的区块链！例如，它可以让你立即连接到[多边形节点](https://moralis.io/how-to-connect-to-polygon-nodes/)和[以太坊节点](https://moralis.io/how-to-connect-to-ethereum-nodes/)。

Moralis 的元宇宙 SDK 使您能够在 Unity、Xbox 和 iOS 等世界领先的平台上探索游戏设计的可能性。此外，它强大的 API，包括 [Moralis NFT API](https://moralis.io/ultimate-nft-api-exploring-moralis-nft-api/) ，允许你将强大的 Web3 特性集成到你的游戏中，支撑它的 P2E 经济。**